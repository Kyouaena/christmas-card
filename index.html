<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Shiny Christmas Tree</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        #canvas-container { width: 100%; height: 100%; background: radial-gradient(circle, #1a2a6c, #000000); }
        
        /* æ¼‚äº®çš„ UI */
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding-bottom: 50px;
        }
        .title {
            position: absolute; top: 10%; 
            color: #ffd700; font-family: 'Times New Roman', serif;
            font-size: 40px; letter-spacing: 5px;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ffd700;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow { from { opacity: 0.8; } to { opacity: 1; text-shadow: 0 0 20px #ff0000, 0 0 40px #ffd700; } }

        .btn-group { display: flex; gap: 15px; pointer-events: auto; }
        button {
            background: rgba(0,0,0,0.5); border: 1px solid #ffd700; color: #ffd700;
            padding: 10px 20px; border-radius: 20px; cursor: pointer;
            backdrop-filter: blur(5px); font-size: 16px; transition: 0.3s;
        }
        button:hover { background: rgba(255, 215, 0, 0.2); transform: scale(1.05); }
    </style>
    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="ui">
        <div class="title">MERRY CHRISTMAS</div>
        <div class="btn-group">
            <button onclick="changeColor('gold')">âœ¨ é‡‘è‰²ä¼ è¯´</button>
            <button onclick="changeColor('colorful')">ğŸŒˆ å½©è‰²éœ“è™¹</button>
        </div>
    </div>

    <script>
        let scene, camera, renderer, particles, geometry, materials = [];
        let mouseX = 0, mouseY = 0;
        let windowHalfX = window.innerWidth / 2;
        let windowHalfY = window.innerHeight / 2;

        init();
        animate();

        function init() {
            const container = document.getElementById('canvas-container');
            
            scene = new THREE.Scene();
            // æ·»åŠ ä¸€ç‚¹ç¯å¢ƒé›¾ï¼Œå¢åŠ æ·±é‚ƒæ„Ÿ
            scene.fog = new THREE.FogExp2(0x000000, 0.0008);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 3000);
            camera.position.z = 1000;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // --- æ ¸å¿ƒï¼šåˆ›å»ºå‘å…‰ç²’å­è´´å›¾ ---
            const sprite = new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/spark1.png');

            geometry = new THREE.BufferGeometry();
            const vertices = [];
            const colors = [];

            // ç”Ÿæˆåœ£è¯æ ‘å½¢çŠ¶
            const count = 20000;
            for (let i = 0; i < count; i++) {
                const x = Math.random() * 2000 - 1000;
                const y = Math.random() * 2000 - 1000;
                const z = Math.random() * 2000 - 1000;
                
                // è¿™é‡Œå…ˆéšæœºåˆ†å¸ƒï¼Œç„¶ååœ¨ animate é‡Œèšåˆæˆæ ‘ï¼Œæˆ–è€…ç›´æ¥ç”Ÿæˆæ ‘
                // ä¸ºäº†ç®€å•ä¸”æ•ˆæœå¥½ï¼Œæˆ‘ä»¬ç›´æ¥ç”Ÿæˆä¸€ä¸ªèºæ—‹åœ†é”¥ä½“ï¼ˆæ ‘ï¼‰
                const angle = i * 0.02; 
                const radius = (count - i) * 0.04; // ä¸‹å¤§ä¸Šå°
                const h = i * 0.1 - 800;
                
                // åŠ ä¸Šä¸€ç‚¹éšæœºæŠ–åŠ¨ï¼Œè®©å®ƒçœ‹èµ·æ¥åƒè“¬æ¾çš„æ ‘å¶
                const jiggle = 30; 
                const tx = Math.cos(angle) * radius * 15 + (Math.random()-0.5)*jiggle;
                const ty = h + (Math.random()-0.5)*jiggle;
                const tz = Math.sin(angle) * radius * 15 + (Math.random()-0.5)*jiggle;

                vertices.push(tx, ty, tz);

                // é¢œè‰²ï¼šé‡‘è‰²ä¸ºä¸»
                colors.push(1.0, 0.8, 0.2); 
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            // --- æè´¨ï¼šè¿™æ˜¯â€œäº®æ™¶æ™¶â€çš„å…³é”® ---
            const material = new THREE.PointsMaterial({
                size: 15, // ç²’å­å¤Ÿå¤§æ‰é—ª
                map: sprite, // ä½¿ç”¨å…‰ç‚¹è´´å›¾
                blending: THREE.AdditiveBlending, // å åŠ å‘å…‰æ¨¡å¼
                depthWrite: false, // å…è®¸ç²’å­äº’ç›¸é‡å ä¸é®æŒ¡
                transparent: true,
                vertexColors: true
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);

            // äº¤äº’äº‹ä»¶
            document.addEventListener('mousemove', onDocumentMouseMove);
            document.addEventListener('touchstart', onDocumentTouchStart, { passive: false });
            document.addEventListener('touchmove', onDocumentTouchMove, { passive: false });
            window.addEventListener('resize', onWindowResize);
        }

        // äº¤äº’é€»è¾‘
        function onDocumentMouseMove(event) {
            mouseX = event.clientX - windowHalfX;
            mouseY = event.clientY - windowHalfY;
        }
        function onDocumentTouchStart(event) {
            if (event.touches.length === 1) {
                mouseX = event.touches[0].pageX - windowHalfX;
                mouseY = event.touches[0].pageY - windowHalfY;
            }
        }
        function onDocumentTouchMove(event) {
            if (event.touches.length === 1) {
                event.preventDefault();
                mouseX = event.touches[0].pageX - windowHalfX;
                mouseY = event.touches[0].pageY - windowHalfY;
            }
        }

        function changeColor(mode) {
            const colors = geometry.attributes.color.array;
            for(let i=0; i<colors.length; i+=3) {
                if(mode === 'gold') {
                    colors[i] = 1.0; colors[i+1] = 0.8; colors[i+2] = 0.2;
                } else {
                    colors[i] = Math.random(); colors[i+1] = Math.random(); colors[i+2] = Math.random();
                }
            }
            geometry.attributes.color.needsUpdate = true;
        }

        function onWindowResize() {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const time = Date.now() * 0.0005;

            // è‡ªåŠ¨æ—‹è½¬ + é¼ æ ‡/æ‰‹æŒ‡äº¤äº’
            particles.rotation.y += 0.002; 
            
            // è®©ç›¸æœºè·Ÿéšé¼ æ ‡ç¨å¾®ç§»åŠ¨ï¼Œäº§ç”Ÿè§†å·®ç«‹ä½“æ„Ÿ
            camera.position.x += (mouseX - camera.position.x) * 0.05;
            camera.position.y += (-mouseY - camera.position.y) * 0.05;
            camera.lookAt(scene.position);

            // ç²’å­é—ªçƒåŠ¨ç”» (å¯é€‰)
            // const sizes = geometry.attributes.size; 
            // ... å¯ä»¥åŠ å…¥åŠ¨æ€ç¼©æ”¾é€»è¾‘

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>